import type { CardDef } from '../types';

export const cards: Record<string, CardDef> = {
  console_log: {
    id: 'console_log',
    name: 'Console.log',
    type: 'attack',
    target: 'enemy',
    cost: 1,
    rarity: 'starter',
    description: 'Deal 6 damage.',
    effects: { damage: 6 },
    upgradedEffects: { damage: 9 },
    upgradedDescription: 'Deal 9 damage.',
    icon: 'ðŸ“',
  },
  div_block: {
    id: 'div_block',
    name: 'Div Block',
    type: 'skill',
    target: 'self',
    cost: 1,
    rarity: 'starter',
    description: 'Gain 5 block.',
    effects: { block: 5 },
    upgradedEffects: { block: 8 },
    upgradedDescription: 'Gain 8 block.',
    icon: 'ðŸ›¡ï¸',
  },
  refactor: {
    id: 'refactor',
    name: 'Refactor',
    type: 'skill',
    target: 'self',
    cost: 1,
    rarity: 'starter',
    description: 'Draw 2 cards.',
    effects: { draw: 2 },
    upgradedEffects: { draw: 3 },
    upgradedDescription: 'Draw 3 cards.',
    icon: 'ðŸ”„',
  },
  deploy_to_prod: {
    id: 'deploy_to_prod',
    name: 'Deploy to Prod',
    type: 'attack',
    target: 'enemy',
    cost: 2,
    rarity: 'starter',
    description: 'Deal 14 damage.',
    effects: { damage: 14 },
    upgradedEffects: { damage: 18 },
    upgradedDescription: 'Deal 18 damage.',
    icon: 'ðŸš€',
  },
  // Common cards
  npm_install: {
    id: 'npm_install',
    name: 'npm install',
    type: 'skill',
    target: 'self',
    cost: 1,
    rarity: 'common',
    description: 'Gain 8 block.',
    effects: { block: 8 },
    upgradedEffects: { block: 11 },
    upgradedDescription: 'Gain 11 block.',
    icon: 'ðŸ“¦',
  },
  stack_overflow: {
    id: 'stack_overflow',
    name: 'Stack Overflow',
    type: 'attack',
    target: 'enemy',
    cost: 1,
    rarity: 'common',
    description: 'Deal 9 damage.',
    effects: { damage: 9 },
    upgradedEffects: { damage: 12 },
    upgradedDescription: 'Deal 12 damage.',
    icon: 'ðŸ“š',
  },
  code_review: {
    id: 'code_review',
    name: 'Code Review',
    type: 'skill',
    target: 'enemy',
    cost: 1,
    rarity: 'common',
    description: 'Apply 2 Vulnerable.',
    effects: { applyToTarget: { vulnerable: 2 } },
    upgradedEffects: { applyToTarget: { vulnerable: 3 } },
    upgradedDescription: 'Apply 3 Vulnerable.',
    icon: 'ðŸ”',
  },
  git_push: {
    id: 'git_push',
    name: 'Git Push',
    type: 'attack',
    target: 'enemy',
    cost: 2,
    rarity: 'common',
    description: 'Deal 10 damage. Draw 1 card.',
    effects: { damage: 10, draw: 1 },
    upgradedEffects: { damage: 14, draw: 1 },
    upgradedDescription: 'Deal 14 damage. Draw 1 card.',
    icon: 'â¬†ï¸',
  },
  rubber_duck: {
    id: 'rubber_duck',
    name: 'Rubber Duck Debug',
    type: 'skill',
    target: 'self',
    cost: 1,
    rarity: 'common',
    description: 'Gain 6 block. Draw 1 card.',
    effects: { block: 6, draw: 1 },
    upgradedEffects: { block: 8, draw: 1 },
    upgradedDescription: 'Gain 8 block. Draw 1 card.',
    icon: 'ðŸ¦†',
  },
  // Uncommon cards
  pair_programming: {
    id: 'pair_programming',
    name: 'Pair Programming',
    type: 'attack',
    target: 'enemy',
    cost: 1,
    rarity: 'uncommon',
    description: 'Deal 6 damage twice.',
    effects: { damage: 6, applyToTarget: {} },
    upgradedEffects: { damage: 8 },
    upgradedDescription: 'Deal 8 damage twice.',
    icon: 'ðŸ‘¥',
  },
  sprint_planning: {
    id: 'sprint_planning',
    name: 'Sprint Planning',
    type: 'skill',
    target: 'self',
    cost: 1,
    rarity: 'uncommon',
    description: 'Gain 1 energy. Draw 1 card.',
    effects: { energy: 1, draw: 1 },
    upgradedEffects: { energy: 1, draw: 2 },
    upgradedDescription: 'Gain 1 energy. Draw 2 cards.',
    icon: 'ðŸ“‹',
  },
  technical_debt: {
    id: 'technical_debt',
    name: 'Technical Debt',
    type: 'attack',
    target: 'all_enemies',
    cost: 1,
    rarity: 'uncommon',
    description: 'Deal 7 damage to ALL enemies.',
    effects: { damageAll: 7 },
    upgradedEffects: { damageAll: 10 },
    upgradedDescription: 'Deal 10 damage to ALL enemies.',
    icon: 'ðŸ’¸',
  },
  firewall: {
    id: 'firewall',
    name: 'Firewall',
    type: 'skill',
    target: 'self',
    cost: 2,
    rarity: 'uncommon',
    description: 'Gain 15 block.',
    effects: { block: 15 },
    upgradedEffects: { block: 20 },
    upgradedDescription: 'Gain 20 block.',
    icon: 'ðŸ”¥',
  },
  agile_methodology: {
    id: 'agile_methodology',
    name: 'Agile Methodology',
    type: 'power',
    target: 'self',
    cost: 1,
    rarity: 'uncommon',
    description: 'Gain 2 Strength.',
    effects: { applyToSelf: { strength: 2 } },
    upgradedEffects: { applyToSelf: { strength: 3 } },
    upgradedDescription: 'Gain 3 Strength.',
    icon: 'âš¡',
  },
  // Rare cards
  force_push: {
    id: 'force_push',
    name: 'Force Push',
    type: 'attack',
    target: 'enemy',
    cost: 3,
    rarity: 'rare',
    description: 'Deal 30 damage.',
    effects: { damage: 30 },
    upgradedEffects: { damage: 40 },
    upgradedDescription: 'Deal 40 damage.',
    icon: 'ðŸ’¥',
  },
  kubernetes: {
    id: 'kubernetes',
    name: 'Kubernetes',
    type: 'power',
    target: 'self',
    cost: 2,
    rarity: 'rare',
    description: 'Gain 3 Dexterity.',
    effects: { applyToSelf: { dexterity: 3 } },
    upgradedEffects: { applyToSelf: { dexterity: 4 } },
    upgradedDescription: 'Gain 4 Dexterity.',
    icon: 'â˜¸ï¸',
  },
  full_stack: {
    id: 'full_stack',
    name: 'Full Stack',
    type: 'attack',
    target: 'enemy',
    cost: 2,
    rarity: 'rare',
    description: 'Deal 12 damage. Gain 12 block.',
    effects: { damage: 12, block: 12 },
    upgradedEffects: { damage: 16, block: 16 },
    upgradedDescription: 'Deal 16 damage. Gain 16 block.',
    icon: 'ðŸ—ï¸',
  },
};

export function getCardDef(id: string): CardDef {
  return cards[id];
}

export function getRewardCards(count: number, rarity?: 'common' | 'uncommon' | 'rare'): CardDef[] {
  const pool = Object.values(cards).filter(c => {
    if (c.rarity === 'starter') return false;
    if (rarity) return c.rarity === rarity;
    return true;
  });
  const shuffled = [...pool].sort(() => Math.random() - 0.5);
  return shuffled.slice(0, count);
}
