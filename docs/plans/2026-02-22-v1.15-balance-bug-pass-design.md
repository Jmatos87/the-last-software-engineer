# v1.15.0 — Bug & Balance Pass + Architect Resonance Overhaul

**Date:** 2026-02-22
**Version Target:** v1.15.0
**Informed by:** 10-run simulations for Frontend (5/10), Backend (4/10), Architect (2/10)

---

## Design Goals

- Fix all confirmed bugs from simulation analysis
- Each class and playstyle should have viability with the right RNG — not 100% win rate, failure is intentional
- Weak archetypes (Frontend pure evasion, Backend pure burn) get multiplication hooks so they can compete with the right card draws
- Architect gets the full Resonance overhaul (Option 3 from overhaul options doc)
- Version bump to v1.15.0

---

## Section 1: Bug Fixes

| Bug | File | Fix |
|-----|------|-----|
| `technical_debt` curse upgrade does nothing | `battleActions.ts` `startNewTurn` | Read `curse.effects.stress` per-curse instead of hardcoded `cursesDrawn * 5` |
| `css_custom_props` relic (Frontend epic) dead | `battleEngine.ts` `calculateBlock` | Multiply block by `skillBlockMultiplier / 100` when card type is 'skill' and relic present |
| `circuit_breaker` relic (Backend epic) dead | `battleActions.ts` `executeEnemyTurn` | After damage resolves, if HP ≤ 0 and relic present and `circuitBreakerUsed` not set, clamp HP to 1 and set flag |
| `domain_model` relic (Architect epic) dead | `battleActions.ts` `initBattle` | Mark first 3 cards in opening hand as cost 0 for that hand only |
| Dodge decays per enemy action (BUG-06) | `battleEngine.ts` `tickStatusEffects` | Move dodge decrement out of per-enemy tick; instead decrement once in `executeEnemyTurn` after ALL enemies act |
| Bleed kills earn 0 gold | `battleActions.ts` `startNewTurn` | Merge `bleedKillCount` into `newBattle.killCount` and `bleedGoldEarned` into `newBattle.goldEarned` before returning |
| `404_not_found` (Frontend epic) upgrade identical to base | `frontendCards.ts` | Base: deal 8 + guaranteed overflow (exhaust). Upgraded: deal 8 + guaranteed overflow (no exhaust) — upgrade removes the exhaust |
| `restructure` (Architect) evoke doesn't always fire | `architectCards.ts` + `battleActions.ts` | Change to explicitly evoke oldest slot at time of play, not rely on overflow check |

---

## Section 2: Frontend Balance

### Nerfs

| Card | Change |
|------|--------|
| `flow_state` (legendary) | Upgraded cost 0 → cost 1. Base unchanged. |
| `pointer-events: none` (rare) | Upgraded: 6 dodge + 2 resilience (was 7+3). Base unchanged (5+2). |
| `burst_split` (rare) | Upgraded: +3 extra flow, +1 energy (was +4 flow, +2 energy). Base unchanged. |
| `frame_perfect` (epic) | Upgraded: cost 1, 5 bleed + 4 dodge (was cost 0). Base unchanged. |

### Buffs

| Card | Change |
|------|--------|
| `z_axis_slip` (common) | Add draw 1. Base: 3 dodge + draw 1. Upgraded: 4 dodge + draw 1. |
| `absolute_position` (common) | Add 5 block. Base: 2 dodge + 5 block (cost 1). Upgraded: cost 0, 2 dodge + 5 block. |
| `deferred_load` (rare) | Cost 2 → cost 1. Upgraded: cost 0, 6 dodge + 10 block. |
| `ghost_cursor` (common) | Add +1 flow. Base: cost 0, 3 dmg + 1 dodge + 1 flow. |
| `minify` (common) | Add draw 1. Base: cost 0, reduce next card cost 2 + draw 1. |

### New Dodge-Scaling Cards (3 cards added to Frontend pool)

**`evasion_protocol`** (rare, power, cost 2)
- Description: "While you have any Dodge, your attacks deal +2 damage per Dodge stack."
- Upgraded: +3 damage per Dodge stack.
- Effect: `dodgeScalesDamage: 2` (new CardEffect field — power card, permanent)
- Design intent: Gives pure evasion a damage ceiling. A 5-dodge stack = +10 to every attack.

**`counter_step`** (rare, attack, cost 1)
- Description: "Deal 3 damage per current Dodge stack."
- Upgraded: 4 damage per Dodge stack.
- Effect: `damagePerDodge: 3`
- Design intent: Cash-out card for accumulated dodge stacks. 8 dodge = 24 damage, 24-32 upgraded.

**`phase_counter`** (epic, attack, cost 2, exhaust)
- Description: "Deal 8 damage. If you dodged an attack this combat turn, deal 8 more."
- Upgraded: 12 + 12 on dodge.
- Effect: `damage: 8, bonusDamageIfDodgedThisTurn: 8`
- Design intent: Rewards commitment to evasion with burst payoff. Tracks if dodge fired this turn via new `dodgedThisTurn` flag on BattleState.

### New CardEffect fields needed
```ts
damagePerDodge?: number;            // deal N damage per current dodge stack
dodgeScalesDamage?: number;         // power: +N damage per dodge on all attacks
bonusDamageIfDodgedThisTurn?: number; // bonus damage if a dodge fired this turn
```

### New BattleState field needed
```ts
dodgedThisTurn: boolean;            // set true when a dodge fires, cleared at turn start
```

---

## Section 3: Backend Balance

### Implement 3 Dead Relics

**`css_custom_props`** (Frontend epic relic, `skillBlockMultiplier: 150`):
- In `calculateBlock`: if card type is 'skill' and player has this relic, multiply block by 1.5
- Covers all Frontend skill cards that apply block (css_dodge, deferred_load, viewport_vanish, etc.)

**`circuit_breaker`** (Backend epic relic, `surviveKillingBlow: true`):
- In `executeEnemyTurn` after applying damage: if `newBattle.playerHp <= 0` and relic present and `!newBattle.circuitBreakerUsed`, set `playerHp = 1` and `circuitBreakerUsed = true`
- New `circuitBreakerUsed: boolean` flag on BattleState

**`domain_model`** (Architect epic relic, `firstNCardsFree: 3`):
- In `initBattle`: after drawing opening hand, set the first N cards' `currentCost = 0` for that draw (not permanent — just the first hand)

### Nerfs

| Card | Change |
|------|--------|
| `event_storm` (rare) | Queue chain: 25 → 16 (base), 20 (upgraded). |
| `elemental_convergence` (epic) | Queue values: 15/15/15 → 10/10/10 per element. |

### Buffs

| Card | Change |
|------|--------|
| `connection_pool` (common) | Add `queueBlock: 6`. Now: cost 1, 8 block + queue 6 block. No longer dead. |
| `pub_sub_event` (common) | Cost 1 → cost 0. |
| `kubernetes_pod` (rare) | Simplify: remove deployment. New: cost 2, 10 block + queue 14 block. Clean ice rare. |

### New Burn-Amplifier Cards (4 cards added to Backend pool)

**`fuel_injection`** (rare, attack, cost 1)
- Description: "Deal 8 damage. Double Burn on target."
- Upgraded: "Deal 10 damage. Triple Burn on target."
- Effect: `damage: 8, doubleBurnOnTarget: true` / upgraded: `tripleBurnOnTarget: true`
- Design intent: The Catalyst. Build 4 burn with `exception_throw`, play this → 8 burn. Stack for mass DoT.

**`backdraft`** (epic, attack, cost 2, exhaust)
- Description: "Deal damage equal to Burn stacks × 5 on target. Remove Burn."
- Upgraded: × 6.
- Effect: `damagePerBurn: 5, consumeBurnOnHit: true`
- Design intent: Cash-out card. 12 burn → 60 damage (×5), 72 (×6 upgraded). Winnable pure-burn finish.

**`thermal_cascade`** (epic, power, cost 2)
- Description: "Burn ticks deal ×2 damage."
- Upgraded: ×3 damage.
- Effect: `burnDoTMultiplier: 2` (permanent power, stored on BattleState)
- Design intent: Passive amplifier. 8 burn × 2 = 16 damage/tick instead of 8. Makes sustained burn a real threat.

**`incendiary_comment`** (rare, skill, cost 1)
- Description: "Apply 4 Burn to all enemies."
- Upgraded: 5 Burn to all.
- Effect: `applyBurnAll: 4`
- Design intent: Burn spread. Sets up `backdraft` on a boss with minions, or `thermal_cascade` payoff on all targets simultaneously.

### New CardEffect fields needed
```ts
doubleBurnOnTarget?: boolean;       // double burn stacks on target
tripleBurnOnTarget?: boolean;       // triple burn stacks on target
damagePerBurn?: number;             // deal N per burn stack (with consumeBurnOnHit)
consumeBurnOnHit?: boolean;         // remove burn after damagePerBurn resolves
burnDoTMultiplier?: number;         // power: multiply all burn tick damage by N
applyBurnAll?: number;              // apply N burn to all enemies
```

### New BattleState field needed
```ts
burnDoTMultiplier: number;          // default 1, set by thermal_cascade power card
circuitBreakerUsed: boolean;        // default false, set when circuit_breaker fires
```

---

## Section 4: Architect Resonance Overhaul

Full implementation of Option 3 from `2026-02-22-architect-overhaul-options.md`.

### Core Mechanic: Resonance

Engineer slots are checked at the start of each turn after all passives fire:

1. **Normal**: Each slot fires its `passiveEffect` once
2. **Resonance**: Any adjacent matching pair → that passive fires a second time
3. **Harmonic**: All slots match the same type → all passives fire a third time + `harmonicEffect` fires once per combat

```
[DevOps] [DevOps] [QA]
  +1e      +1e     1vuln
  Resonance: +1e bonus (pair match)
Total: +3 energy, 1 vulnerable/turn
```

```
[Security] [Security] [Security]
  +1reflect   +1reflect   +1reflect
  Harmonic: +3reflect AND deal dmg = 3× counterOffer to all
```

### BattleState additions
```ts
engineerSlots: EngineerSlot[];      // already exists
maxEngineerSlots: number;           // already exists
// No new fields needed — resonance computed from slot array
```

### `whiteboard_marker` Relic Redesign
- Old: "First Power each combat costs 0" — useless (no power cards in kit)
- New: "First Engineer card each combat costs 0" — eliminates turn-1 energy crisis for 1 slot

### `ai_jr` Card Fix
- Current passive: +1 token/turn (no token-spend cards in Architect pool → dead)
- New passive: Draw 1 card/turn
- Evoke stays: deal 10 + tokens×2 to random enemy (tokens still accumulate, evoke becomes the only spend)

### Card Balance Adjustments
| Card | Change |
|------|--------|
| `domain_driven_design` (epic) | 12 damage/slot → 9/slot (base). Upgraded: 12/slot. |
| `systems_thinking` (legendary) | Unchanged — 0-cost exhaust is appropriate legendary tier |
| `devops_engineer` (common) | Unchanged — whiteboard_marker fix removes the pain without changing the card |
| `over_engineering` (rare) | Remove Scope Creep penalty. New: deal 40 damage. Exhaust. Pure nuke. |

### Resonance Computation (pseudocode for `startNewTurn`)
```ts
// 1. Fire all passives normally
for (const slot of battle.engineerSlots) {
  applyEngineerPassive(battle, slot.passiveEffect);
}

// 2. Resonance: adjacent matching pairs fire passive again
for (let i = 0; i < battle.engineerSlots.length - 1; i++) {
  if (battle.engineerSlots[i].id === battle.engineerSlots[i + 1].id) {
    applyEngineerPassive(battle, battle.engineerSlots[i].passiveEffect);
  }
}

// 3. Harmonic: all slots match → fire all passives third time + harmonicEffect
if (battle.engineerSlots.length >= 2 && battle.engineerSlots.every(s => s.id === battle.engineerSlots[0].id)) {
  for (const slot of battle.engineerSlots) {
    applyEngineerPassive(battle, slot.passiveEffect);
  }
  applyEngineerHarmonic(battle, battle.engineerSlots[0].harmonicEffect);
}
```

### Harmonic Effects per Engineer (from overhaul doc, confirmed)
| Engineer | Harmonic Effect |
|----------|----------------|
| DevOps ×3 | Gain 3 energy + draw 3 cards |
| QA ×3 | Apply 3 vulnerable + 3 weak to ALL enemies |
| Security ×3 | Deal damage = 3× counter-offer to all enemies |
| Data ×3 | Draw entire hand again (fill to 10) |
| Frontend Jr ×3 | Gain 8 dodge + apply 6 bleed to all |
| Backend Sr ×3 | System Meltdown: fire ice+fire+lightning at 20 each |
| AI Sr ×3 | Deal damage = tokens × 5 to all, tokens → 0 |
| Principal ×3 | Double all current player status effects |

### Starter Deck
```ts
starterDeckIds: [
  'singleton_pattern', 'singleton_pattern', 'singleton_pattern', 'singleton_pattern',
  'devops_engineer', 'devops_engineer',
  'qa_engineer',
  'design_doc',
  'code_review',
  'coffee_break',
]
```
Two devops in starter → resonance on turn 2 = +2 energy, teaches the mechanic immediately.

---

## Files to Touch

| File | Changes |
|------|---------|
| `src/types/index.ts` | New CardEffect fields (all 4 sections), new BattleState fields, `EngineerSlot.harmonicEffect`, `circuitBreakerUsed`, `burnDoTMultiplier`, `dodgedThisTurn` |
| `src/utils/battleEngine.ts` | Dodge decay fix, `skillBlockMultiplier` implementation, `damagePerDodge`, `dodgeScalesDamage` logic |
| `src/store/battleActions.ts` | Bleed kill gold fix, `technical_debt` stress fix, `circuit_breaker`, `domain_model`, `firstNCardsFree`, burn amplifier logic, Resonance/Harmonic logic in `startNewTurn`, `burnDoTMultiplier` in burn tick, `dodgedThisTurn` reset, new dodge/burn card effects |
| `src/data/cards/frontendCards.ts` | Nerf 4 cards, buff 5 cards, add 3 new cards |
| `src/data/cards/backendCards.ts` | Nerf 2 cards, buff 3 cards, add 4 new cards |
| `src/data/cards/architectCards.ts` | `ai_jr` passive fix, `over_engineering` fix, `domain_driven_design` nerf, `restructure` fix |
| `src/data/items.ts` | `whiteboard_marker` redesign, verify `circuit_breaker`/`css_custom_props`/`domain_model` fields |
| `src/store/gameStore.ts` | GAME_VERSION → '1.15.0' |

---

## Win Rate Targets (post-fix)

Not aiming for 100% — failure is intentional. Targets with optimal RNG:

| Class | Current | Target |
|-------|---------|--------|
| Frontend | 5/10 | 6-7/10 |
| Backend | 4/10 | 5-6/10 |
| Architect | 2/10 | 4-5/10 |
| AI Engineer | ~4/10 est | unchanged |
